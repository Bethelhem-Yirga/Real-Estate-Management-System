{% load static %}
<!DOCTYPE html>
<html>
<head>
  
  <link rel="stylesheet" type="text/css" href="{% static 'css/market.css' %}">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    .dashboard-info {
      display: flex;
      justify-content: space-between;
      margin-bottom: 40px;
    
    }
    
    .dashboard-item {
      text-align: center;
      flex-basis: 30%;
      padding: 10px;
      background-color:#ffffff;
      border-radius: 5px;
      
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    
    .dashboard-item h4 {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .dashboard-item p {
      font-size: 20px;
      color: #555555;
    }  .navbar-container {
      display: flex;
      margin-top:5px ;
    }
    
    
  
    
    .nav-links {
      list-style-type: none;
      padding: 0;
    }
    
    .nav-links li {
      margin-bottom: 10px;
    }
    
    .nav-links a {
      display: block;
      padding: 10px;
      text-decoration: none;
      color: whitesmoke;
    }
    
    .nav-links a:hover {
      background-color: #ccc;
    }
    
    .form-container {
      flex:0.4;
      padding: 20px;
    }
    
    .form-content {
      display: none;
      max-width: 400px;
      margin: 20px auto;  
      padding: 20px;
      border-radius: 5px;
    }
    .navbar .lo{
float: right;
    }
    
    .form-content.active {
      display: block;
    }
    
    .form-content h2 {
      margin-bottom: 10px;
    }
    
    .form-content form {
      display: flex;
      flex-direction: column;
    }
   
    .maintenance-table,
    .application-table {
        border-collapse: collapse;
        width: 100%;
    }

  
    .maintenance-table th,
    .maintenance-table td
    {
        border: 1px solid #ddd;
        padding: 8px;
    }
    #application-table {
  width: 100%;
  border-collapse: collapse;
}

#application-table th,
#application-table td {
  padding: 8px;
  border: 1px solid #ddd;
}

#application-table th {
  background-color: black;
  color: white;
}

#application-table tr:nth-child(even) {
  background-color: #f2f2f2;
}

#application-table tr:hover {
  background-color: #ddd;
}

    .maintenance-table th{
      background-color: #030303;
        color: white;
    }
    .application-table th{
        background-color: #080404;
        color: white;
    }

  </style>
  <script>
    function toggleForm(formId) {
      var formContents = document.getElementsByClassName('form-content');
      for (var i = 0; i < formContents.length; i++) {
        formContents[i].classList.remove('active');
      }
      var form = document.getElementById(formId);
      form.classList.add('active');
    }
    function sendToWorkOrder(maintenanceId) {
            fetch(`/send_to_work_order/${maintenanceId}`)
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                window.location.reload(); 
            });
        }

        function updateStatus(workOrderId, newStatus) {
            fetch(`/update_work_order_status/${workOrderId}/${newStatus}`)
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                window.location.reload(); 
            });
        }
        document.querySelectorAll('.status-link').forEach(link => {
        link.addEventListener('click', function(event) {
            event.preventDefault();
            const workOrderId = this.dataset.workOrderId;
            const newStatus = this.dataset.newStatus;
            fetch(`/update_status/${workOrderId}/${newStatus}`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/json',
                },
            })
            .then(response => {
                if (response.ok) {
                    return response.json();
                }
                throw new Error('Network response was not ok.');
            })
            .then(data => {
                // Update the status in the UI
                this.textContent = data.status;
                this.dataset.newStatus = data.newStatus;
            })
            .catch(error => {
                console.error('There was a problem with the fetch operation:', error);
            });
        });
    }); 
    </script>
</head>
<body>
  <header>
    <nav class="navbar">
      <div class="logo">
        <img src="{% static 'img/logo.png' %}" alt="Logo">
        <span class="logo-name">Gift Real Estate</span>
      </div>
      
      <div class="profile">
        <img src="{{ profile.image.url }}" alt="Profile Photo" class="profile-photo">
        <div class="profile-info">
          <span class="name">{{ profile.first_name }} {{ profile.last_name }}</span>
          <span class="email">{{ profile.email }}</span>
        </div>
      </div>
    </nav>
  </header>
  
  <div class="container">
    <div class="sidebar">
      <div class="profile">
        <img src="{{ profile.image.url }}" alt="Profile Photo" class="profile-photo">
        <div class="profile-info">
          <h3 class="name">{{ profile.first_name }} {{ profile.last_name }}</h3>
          <p class="email">{{ profile.email }}</p>
        </div>
      </div>

      <ul>
        <li><a href="#" class="active">Dashboard</a></li>
        <li><a href="#" onclick="toggleForm('profile')">Profile</a></li>
        <li><a href="#" onclick="toggleForm('maintenance-form')">Maintenance Request</a></li>
        <li><a href="#" onclick="toggleForm('application-table')">Application</a></li>
        <li><a href="#" onclick="toggleForm('maintenance-report')">Maintenance Report</a></li>
        <li> <a href="#" onclick="toggleForm('financial-report')">Financial Report</a> </li>  
        <li> <a href="#" onclick="toggleForm('salesperson-report')">Salesperson Report</a></li>  
        <li> <a href="#" onclick="toggleForm('chatbot-form')">Message</a></li>
      </ul>
    </div>
    <div class="form-container">
      <div id="maintenance-form" class="form-content">
          <table class="maintenance-table">
              <thead>
                  <tr>
                      <th>Email</th>
                      <th>Building Number</th>
                      <th>Room Number</th>
                      <th>Floor Number</th> 
                      <th>Type of Maintenance</th> 
                      <th>Action</th> 
                  </tr>
              </thead>
              <tbody>
                  {% for maintenance_obj in maintenance %}
                  <tr>
                      <td>{{ maintenance_obj.email }}</td>
                      <td>{{ maintenance_obj.building_number }}</td>
                      <td>{{ maintenance_obj.room_number }}</td>
                      <td>{{ maintenance_obj.floor_number }}</td>
                      <td>{{ maintenance_obj.type_of_maintenance }}</td>
                      <td><a href="{% url 'send_to_work_order' maintenance_obj.id %}">Send</a></td>

                  </tr>
                  {% endfor %}
              </tbody>
          </table>
      </div>
      
      <div id="application-table" class="form-content">
          <h2>Application</h2>
          <table>
            <thead>
                <tr>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Email</th>
                    <th>Phone Number</th>
                    <th>Nationality</th>
                    <th>Address</th>
                    <th>Work Status</th>
                    <th>Gender</th>
                    <th>Marital Status</th>
                    <th>DateAdded</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for application_obj in applications %}
                <tr>
                    <td>{{ application_obj.first_name }}</td>
                    <td>{{ application_obj.last_name }}</td>
                    <td>{{ application_obj.email }}</td>
                    <td>{{ application_obj.phone_number }}</td>
                    <td>{{ application_obj.nationality }}</td>
                    <td>{{ application_obj.address }}</td>
                    <td>{{ application_obj.work_status }}</td>
                    <td>{{ application_obj.gender }}</td>
                    <td>{{ application_obj.marital_status }}</td>
                    <td>{{ application_obj.date_added }}</td>
                    <td>
                      
                      <a href="{% url 'accept_application' application_obj.id %}">Accept</a>
                      <a href="{% url 'reject_application' application_obj.id %}">Reject</a>
                              

                      </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
         
      </div>
  </div>
        
      
      <div id="chatbot-form" class="form-content">
        <h2>Chatbot</h2>
        <textarea id="chat" name="chat" required></textarea>
        <br>
        <button type="submit">Send</button>
      </form>
      </div>
    </div>
  </div>
 
</body>
</html>